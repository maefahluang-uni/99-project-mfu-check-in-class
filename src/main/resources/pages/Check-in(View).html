<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Home</title>
        <style>
            .container {
                position: relative;
                display: flex;
                align-items: flex-start;
                width: 50%;
            }

            .table-center {
                background: lightgoldenrodyellow;
                overflow-x: scroll;
            }

            .table-left,
            .table-right {
                background: lightsteelblue;
            }

            table,
            th,
            td {
                border: 1px solid black;
            }

            th,
            td {
                padding: .5em 1em;
            }
        </style>
        <script th:inline="javascript">
            /*<![CDATA[*/
                let userdata = /*[[${userdata}]]*/ {
                    "id": 1150,
                    "role": "LECTURER",
                    "password": null,
                    "school": "School of Information Technology",
                    "department": "Software Engineering",
                    "name": "Dr.Sujitra Arwatchananukul"
                };
                console.log(userdata);
                let attendanceHistory = /*[[${attendanceHistory}]]*/ 'default';
                console.log(attendanceHistory);
                let semester = /*[[${semester}]]*/ {
                    "year": 2023,
                    "id": 6666,
                    "dateStart": "8/16/2023",
                    "term": 1,
                    "dateFinish": "12/16/2023"
                };
                console.log(semester);

            /*]]>*/
        </script>
    </head>
    <body th:if="${userdata.getRole().equals('LECTURER')}">
        


        <div class="container">
            <div class="table-left">
                <table id="student-table">
                    <tr>
                        <th>Student ID</th>
                    </tr>
                </table>
            </div>
            <div class="table-center">
                <table id="week-table">
                    <!-- INSERT WEEK TOTAL -->
                </table>
            </div>
            <div class="table-right">
                <table id="total-checkin">
                    <tr>
                        <th>Totals</th>
                    </tr>
                </table>
            </div>
        </div>

        <div class="table" id="course">
            <div class="header">
                <div class="cell">Student-Id</div>
            </div>
        </div>
        <script>
            // Get form values
            const ST_C = semester.dateStart.split("/"); 
            const ST_Month = parseInt(ST_C[0], 10);
            const ST_Day = parseInt(ST_C[1], 10);
            const ST_Year = parseInt(ST_C[2], 10);
            const StartDate = new Date(ST_Year, ST_Month, ST_Day); // Month in JavaScript Date starts from 0 (0 - January, 1 - February, ...)
            const ET_C = semester.dateFinish.split("/"); 
            const ET_Month = parseInt(ET_C[0], 10);
            const ET_Day = parseInt(ET_C[1], 10);
            const ET_Year = parseInt(ET_C[2], 10);
            const EndDate = new Date(ET_Year, ET_Month, ET_Day);
            const diffTime = Math.abs(EndDate - StartDate);
            const totalWeeks = Math.ceil(diffTime / (1000 * 60 * 60 * 24 * 7));
            // console.log('total week to check-in:', totalWeeks);

            const tableHeader = document.querySelector('.header');
            const weekRow = document.createElement('div');
            weekRow.classList.add('cell');
            for (let index = 1; index <= totalWeeks; index++) {
                const weekHeader = document.createElement('div');
                weekHeader.classList.add('week-header');
                weekHeader.textContent = `Week ${index}`;
                weekRow.appendChild(weekHeader);
            }
            tableHeader.appendChild(weekRow);

            const studentTable = document.getElementById("student-table");
            const weekTable = document.getElementById("week-table");
            const totalsTable = document.getElementById("total-checkin");
            
            const TotalWeeks = [1, 2, 3, 4, 5]
            const WeekColumn = weekTable.insertRow();
            TotalWeeks.forEach(week => {
                const cell = WeekColumn.insertCell();
                cell.innerHTML = week;
            });
         
            const TotalStudents = {
                6531503070: true,
                6531503071: true,
                6531503072: true,
                6531503073: true,
                6531503074: true,
                6531503075: true,
                6531503076: true,
                6531503077: true,
            }

            const SampleData = {
                6531503070: {
                    5: true,
                    4: true,
                },
                6531503071: {
                    1: true,
                },
            };

            // Function to insert data into the tables for multiple students
            function insertDataForMultipleStudents() {
                for (const studentid in TotalStudents) {
                    // insert column Student ID
                    const LEFT = studentTable.insertRow();
                    const studentCell = LEFT.insertCell();
                    studentCell.textContent = studentid;
                    // verify column each of Student ID has check-in by each week
                    const CENTER = weekTable.insertRow();
                    const verify = SampleData[studentid];
                    TotalWeeks.forEach(week => {
                        const cell = CENTER.insertCell();
                        if (verify) {
                            if (verify[week]) {
                                cell.innerHTML = "true";
                            } else {
                                cell.innerHTML = "-";
                            }
                        } else {
                            cell.innerHTML = "-";
                        }
                    });
                    const RIGHT = totalsTable.insertRow();
                    const totalcheck = RIGHT.insertCell();
                    totalcheck.textContent = verify && Math.min(Object.keys(verify).length, TotalWeeks.length) || 0;
                    
                }
            }
            // Call the function to insert data when the page loads
            window.onload = insertDataForMultipleStudents;















            function getDateByWeekNumber(semesterStart, semesterEnd, subjectPeriod, weekNumber) {
                const startDate = new Date(semesterStart);
                const endDate = new Date(semesterEnd);

                // Calculate the duration of the semester in milliseconds
                const semesterDuration = endDate - startDate;

                // Calculate the milliseconds in a week
                const millisecondsInWeek = 7 * 24 * 60 * 60 * 1000;

                // Calculate the start date of the given week number
                const weekStartDate = new Date(startDate.getTime() + (weekNumber - 1) * millisecondsInWeek);

                // Calculate the day of the week for the subject period
                const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                const dayIndex = days.indexOf(subjectPeriod.split(',')[0]);

                // Find the date of the specific day (e.g., Friday) within the week
                let subjectDate = new Date(weekStartDate);
                subjectDate.setDate(weekStartDate.getDate() + (dayIndex - weekStartDate.getDay() + 7) % 7);

                // Extract the time range from the subject period
                const timeRange = subjectPeriod.split(',')[1].trim();
                const [startTime, endTime] = timeRange.split(' - ');

                // Extract hours and minutes
                const [startHour, startMinute] = startTime.split(':').map(Number);
                const [endHour, endMinute] = endTime.split(':').map(Number);

                // Set the time for the subject period
                subjectDate.setHours(startHour, startMinute);

                // Check if the calculated date is within the semester duration
                if (subjectDate < startDate || subjectDate > endDate) {
                    return "This week's date is outside the semester duration.";
                }

                // Construct and return the date and time of the subject period
                const formattedDate = subjectDate.toLocaleDateString('en-US', {
                    weekday: 'short',
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric',
                });
                const formattedStartTime = subjectDate.toLocaleTimeString('en-US', { timeStyle: 'short' });
                const formattedEndTime = new Date(subjectDate.getTime() + (endHour * 60 + endMinute) * 60000)
                    .toLocaleTimeString('en-US', { timeStyle: 'short' });

                return `For week ${weekNumber}, the date for ${subjectPeriod} is ${formattedDate} from ${formattedStartTime} to ${formattedEndTime}.`;
            }

            // Example usage:
            const semesterStart = '8/16/2023';
            const semesterEnd = '12/16/2023';
            const subjectPeriod = 'Fri, 13:00 - 14:50';
            const weekNumber = 14;

            const result = getDateByWeekNumber(semesterStart, semesterEnd, subjectPeriod, weekNumber);
            console.log(result) // For week 14, the date for Fri, 13:00 - 14:50 is Fri, Nov 17, 2023 from 1:00 PM to 3:50 AM.

        </script>
    </body>
</html>
